import{r as n,a as m,j as e,u as y,b as C}from"./index-DNj1_qxT.js";import{A as v,L as f,f as E}from"./ActivityPage-fKLvZNOX.js";import{S as k,b as T,a as F,F as L,M as q,D as P}from"./AnswerComponents-CUBhgkTS.js";const R=({answer:a,question:s,testType:l})=>{const[c,r]=n.useState(null),[o,i]=n.useState(null),[t,d]=n.useState(null),[h,u]=n.useState(!0),x=m();n.useEffect(()=>{(async()=>{try{const w=await fetch("http://127.0.0.1:8000/ieltsgo/api/validate_writing/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_response:a,question:s,test_type:l})}),_=await w.json();w.ok?(r(_.band_score),i(_.evaluation),d(_.improve_version)):console.error("Response Error")}catch(w){console.error("Error sending text:",w),r("/"),i("Error: AI Resources might have been exhausted. Please come back tomorrow."),d("Error: AI Resource has been exhaustedError: AI Resources might have been exhausted. Please come back tomorrow.")}finally{u(!1)}})()},[]);const p={show_timer:!1},b=()=>{navigator.clipboard.writeText(t),console.log("Improved version text copied.")},N=e.jsxs("div",{className:"",children:[e.jsx("p",{className:"eval-label",children:"TASK PROMPT:"}),e.jsx("p",{className:"",children:s}),e.jsx("hr",{className:""}),e.jsx("p",{className:"eval-label",children:"YOUR ANSWER:"}),e.jsx("p",{className:"",children:a}),e.jsx("hr",{className:""})]}),S=e.jsxs("div",{className:"answer-container",children:[e.jsx("p",{className:"eval-label",children:"EVALUATION"}),e.jsx("hr",{}),e.jsxs("div",{className:"eval-container flex-row",children:[e.jsxs("div",{className:"band-score-container flex-col border-style-1 color-scheme-4",children:[e.jsx("p",{className:"eval-label",style:{fontSize:"15px",marginTop:0},children:"BAND SCORE:"}),h?e.jsx(f,{width:"100%",height:"90px"}):e.jsx("p",{className:"band-score",children:c})]}),e.jsx("div",{className:"eval-text text-align-left",children:h?e.jsx(f,{width:"300px",height:"100px"}):o})]}),e.jsx("hr",{}),e.jsxs("div",{className:"improved-text border-style-1 color-scheme-1",style:{position:"relative"},children:[e.jsx("button",{className:"copy-btn",onClick:b,children:e.jsx("svg",{"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{fillRule:"evenodd",d:"M8 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1h2a2 2 0 0 1 2 2v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2Zm6 1h-4v2H9a1 1 0 0 0 0 2h6a1 1 0 1 0 0-2h-1V4Zm-6 8a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Zm1 3a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2H9Z",clipRule:"evenodd"})})}),e.jsx("p",{className:"eval-label text-align-left",children:"Improved Version:"}),e.jsx("div",{className:"text-align-left",children:h?e.jsx(f,{width:"100%",height:"80px"}):t})]})]});return e.jsx(v,{headerNavFields:p,contentFields:{left_content:N,right_content:S},isDoublePanel:1,footerNavFields:{back:()=>x("/test/selection/all"),show_submit:!1,show_arrows:!1,show_back:!0}})},g=async(a,s,l,c,r,o,i=null)=>{try{console.log("asn",s,"cans",l);const t=await fetch("http://127.0.0.1:8000/ieltsgo/api/validate_answers/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_type:a,answers:s,correct_answers:l,...i!==null&&{n_choices:i}})}),d=await t.json();t.ok?(c(d.score),r(d.evaluation)):console.error("Response Error")}catch(t){console.error("Error sending text:",t)}finally{o(!1)}},j=({score:a,testData:s,externalTime:l})=>{const c=s.answers.flat().length,r=Math.round(a/c*100),o=r>=50?"Great Score.":"You might want to try again.",i=m();return e.jsx("div",{className:"score-container",children:e.jsxs("div",{className:"score-card flex-col color-scheme-1",children:[e.jsxs("div",{className:"flex-row",children:[e.jsxs("div",{className:`percent-box flex-row ${r>=50?"high-score":"low-score"}`,children:[e.jsx("span",{children:r}),e.jsx("span",{style:{fontSize:"25px"},children:"%"})]}),e.jsxs("div",{className:"score-details-container",children:[e.jsxs("div",{className:"score-details color-scheme-4",children:[e.jsxs("span",{className:"q-line",children:["Score: ",a," / ",c]}),e.jsxs("span",{className:"q-line",children:["Time: ",E(l)]})]}),e.jsx("div",{className:"score-spacer"}),e.jsx("span",{className:"score-comment",children:o})]})]}),e.jsx("div",{className:"score-card-footer flex-row",children:e.jsxs("div",{className:"flex-row flex-center clickable",onClick:()=>i("/"),children:[e.jsx("b",{children:"Continue"}),e.jsx("svg",{className:"score-footer-icon color-scheme-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 12H5m14 0-4 4m4-4-4-4"})})]})})]})})},A=({answer:a,testData:s,externalTime:l})=>{const[c,r]=n.useState(null),[o,i]=n.useState(null),[t,d]=n.useState(!0),h=m();n.useEffect(()=>{g(s.test_type,a,s.answers,r,i,d,s.choices[0].length)},[s]);const u={show_timer:!1};if(t)return e.jsx("p",{children:"Loading..."});const x=t?e.jsx(f,{width:"100%",height:"90px"}):e.jsx(k,{questions:s.questions,choices_list:s.choices,evaluation:o},"singleChoice"),p=e.jsx(j,{score:c,testData:s,externalTime:l});return e.jsx(v,{headerNavFields:u,contentFields:{left_content:x,right_content:p},isDoublePanel:1,footerNavFields:{back:()=>h("/test/selection/all"),show_submit:!1,show_arrows:!1,show_back:!0}})},B=({answer:a,testData:s,externalTime:l})=>{const[c,r]=n.useState(null),[o,i]=n.useState(null),[t,d]=n.useState(!0),h=m();n.useEffect(()=>{g(s.test_type,a,s.answers,r,i,d,s.choices[0].length)},[s]);const u={show_timer:!1};if(t)return e.jsx("p",{children:"Loading..."});const x=t?e.jsx(f,{width:"100%",height:"90px"}):e.jsx(T,{questions:s.questions,choices_list:s.choices,evaluation:o},"multiChoice"),p=e.jsx(j,{score:c,testData:s,externalTime:l});return e.jsx(v,{headerNavFields:u,contentFields:{left_content:x,right_content:p},isDoublePanel:1,footerNavFields:{back:()=>h("/test/selection/all"),show_submit:!1,show_arrows:!1,show_back:!0}})},M=({answer:a,testData:s,externalTime:l})=>{const[c,r]=n.useState(null),[o,i]=n.useState(null),[t,d]=n.useState(!0),h=m();n.useEffect(()=>{g(s.test_type,a,s.answers,r,i,d,s.questions[0].length)},[s]);const u={show_timer:!1};if(t)return e.jsx("p",{children:"Loading..."});const x=t?e.jsx(f,{width:"100%",height:"90px"}):e.jsx(F,{answer:a,questions:s.questions,topics:s.topics,evaluation:o,correct_answer:s.answers},"fillBlanks"),p=e.jsx(j,{score:c,testData:s,externalTime:l});return e.jsx(v,{headerNavFields:u,contentFields:{left_content:x,right_content:p},isDoublePanel:1,footerNavFields:{back:()=>h("/test/selection/all"),show_submit:!1,show_arrows:!1,show_back:!0}})},O=({answer:a,testData:s,externalTime:l})=>{const[c,r]=n.useState(null),[o,i]=n.useState(null),[t,d]=n.useState(!0);n.useEffect(()=>{g(s.test_type,a,s.answers,r,i,d)},[s]);const h={show_timer:!1};if(t)return e.jsx("p",{children:"Loading..."});const u=t?e.jsx(f,{width:"100%",height:"90px"}):e.jsx(L,{answer:a,table_data:s.table_data,topic:s.topic,evaluation:o,correct_answer:s.answers},"fillTable"),x=e.jsx(j,{score:c,testData:s,externalTime:l});return e.jsx(v,{headerNavFields:h,contentFields:{left_content:u,right_content:x},isDoublePanel:1})},I=({answer:a,testData:s,externalTime:l})=>{const[c,r]=n.useState(null),[o,i]=n.useState(null),[t,d]=n.useState(!0),h=m();n.useEffect(()=>{g(s.test_type,a,s.answers,r,i,d,s.num_questions)},[s]);const u={show_timer:!1};if(t)return e.jsx("p",{children:"Loading..."});const x=t?e.jsx(f,{width:"100%",height:"90px"}):e.jsx(q,{answer:a,rows:s.rows,num_questions:s.num_questions,topic:s.topic,evaluation:o},"mapTable"),p=e.jsx(j,{score:c,testData:s,externalTime:l});return e.jsx(v,{headerNavFields:u,contentFields:{left_content:x,right_content:p},isDoublePanel:1,footerNavFields:{back:()=>h("/test/selection/all"),show_submit:!1,show_arrows:!1,show_back:!0}})},V=({answer:a,testData:s,externalTime:l})=>{const[c,r]=n.useState(null),[o,i]=n.useState(null),[t,d]=n.useState(!0),h=m();n.useEffect(()=>{g(s.test_type,a,s.answers,r,i,d,s.num_questions)},[s]);const u={show_timer:!1};if(t)return e.jsx("p",{children:"Loading..."});const x=t?e.jsx(f,{width:"100%",height:"90px"}):e.jsx(P,{answer:a,word_box:s.word_box,questions:s.questions,evaluation:o,correct_answer:s.answers},"dragDrop"),p=e.jsx(j,{score:c,testData:s,externalTime:l});return e.jsx(v,{headerNavFields:u,contentFields:{left_content:x,right_content:p},isDoublePanel:1,footerNavFields:{back:()=>h("/test/selection/all"),show_submit:!1,show_arrows:!1,show_back:!0}})};function J(){var d,h,u,x,p;const{skill:a}=y(),s=C(),l=((d=s.state)==null?void 0:d.answer)||"",c=((h=s.state)==null?void 0:h.question)||"No prompt available.",r=((u=s.state)==null?void 0:u.testType)||"",o=((x=s.state)==null?void 0:x.testData)||[],i=((p=s.state)==null?void 0:p.external_time)||0;let t=e.jsx("p",{children:"No valid evaluation found."});return a==="writing"?t=e.jsx(R,{answer:l,question:c,testType:r}):o.test_type==="single_selection"?t=e.jsx(A,{answer:l,testData:o,externalTime:i}):o.test_type==="double_selection"?t=e.jsx(B,{answer:l,testData:o,externalTime:i}):o.test_type==="fill_sentence_1"||o.test_type==="fill_sentence_2"||o.test_type==="fill_list"?t=e.jsx(M,{answer:l,testData:o,externalTime:i}):o.test_type==="fill_table"?t=e.jsx(O,{answer:l,testData:o,externalTime:i}):o.test_type==="map"?t=e.jsx(I,{answer:l,testData:o,externalTime:i}):(o.test_type==="word_box"||o.test_type==="flow_chart")&&(t=e.jsx(V,{answer:l,testData:o,externalTime:i})),e.jsx("div",{children:t})}export{J as default};

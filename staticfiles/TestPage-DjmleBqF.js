import{j as s,u as W,r as d,a as I}from"./index-DNj1_qxT.js";import{a as q}from"./index-DW_MHI2K.js";import{A as y}from"./ActivityPage-fKLvZNOX.js";import{W as H,F as U,M as O,D as Q,a as z,S as G,b as J}from"./AnswerComponents-CUBhgkTS.js";const v=({diagramUrl:t,text:o})=>s.jsxs("div",{className:"questions-container",children:[s.jsx("div",{children:s.jsx("p",{className:"question-text",dangerouslySetInnerHTML:{__html:o.replace(/\n/g,"<br/>")}})}),s.jsx("div",{className:"flex-col flex-center",children:t&&s.jsx("img",{class:"question-diagram",src:t,alt:"Question's diagram"})})]}),C=({text:t})=>s.jsx("div",{className:"questions-container",children:s.jsx("p",{className:"question-text",dangerouslySetInnerHTML:{__html:t.replace(/\n/g,"<br/>")}})});function K({question:t,diagramUrl:o,testType:n,text:a,setAnswer:e}){const i=n==="task_1"?150:250,r=n==="task_1"?20:40;return[`Write at least ${i} words in the text box. It is recommended to complete this task within ${r} minutes.`,s.jsx(v,{diagramUrl:o,text:t},"questionPanel"),s.jsx(H,{minWordCount:i,text:a,setAnswer:e},"writingBox"),!1,r]}function V({text:t,questions:o,choices_list:n,setAnswer:a,testType:e,skill:i}){const r=o.length*2+20,l=`${i==="reading"?"Read":"Listen"} and answer the questions provided in the right panel. 
  ${i==="reading"?"The recommended completion time is "+r+" minutes.":""}`,_=!1,w=e==="single_selection"?s.jsx(G,{questions:o,choices_list:n,setAnswer:a},"singleChoice"):s.jsx(J,{questions:o,choices_list:n,setAnswer:a},"multipleChoice");return[l,s.jsx(C,{text:t},"questionPanel"),w,_,r]}function X({text:t,questions:o,topics:n,setAnswer:a,testType:e,skill:i}){const r=o.length*2+20;return[`${i==="reading"?"Read":"Listen"} and answer the questions provided in the right panel. 
  ${i==="reading"?"The recommended completion time is "+r+" minutes.":""}`,s.jsx(C,{text:t},"questionPanel"),s.jsx(z,{questions:o,topics:n,setAnswer:a,testType:e},"fillBlanks"),!1,r]}function Y({text:t,table_data:o,topic:n,setAnswer:a,skill:e}){const i=o.slice(1).length*2+20;return[`${e==="reading"?"Read":"Listen"} and complete the table in the right panel. 
  ${e==="reading"?"The recommended completion time is "+i+" minutes.":""}`,s.jsx(C,{text:t},"questionPanel"),s.jsx(U,{table_data:o,topic:n,setAnswer:a},"fillTable"),!1,i]}function Z({text:t,diagramUrl:o,topic:n,num_questions:a,rows:e,setAnswer:i,skill:r}){const l=a*2+20;return[`${r==="reading"?"Read":"Listen"} and answer the questions provided in the right panel. 
  ${r==="reading"?"The recommended completion time is "+l+" minutes.":""}`,s.jsx(v,{diagramUrl:o,text:t},"questionPanel"),s.jsx(O,{diagramUrl:o,topic:n,num_questions:a,rows:e,setAnswer:i},"map"),!1,l]}function ee({text:t,word_box:o,questions:n,setAnswer:a,skill:e}){const i=n.length*2+20;return[`${e==="reading"?"Read":"Listen"} and answer the questions provided in the right panel. 
  ${e==="reading"?"The recommended completion time is "+i+" minutes.":""}`,s.jsx(C,{text:t},"questionPanel"),s.jsx(Q,{word_box:o,questions:n,setAnswer:a},"dragDrop"),!1,i]}function ie(){const{skill:t,isDoublePanel:o,testType:n,itemId:a}=W(),[e,i]=d.useState(null),[r,l]=d.useState(""),[_,w]=d.useState(!1),[$,j]=d.useState(!1),[b,M]=d.useState({}),[T,S]=d.useState(0),D=I(),c=d.useRef(null);if(d.useEffect(()=>{j(!0);const u=async()=>{try{const p=await q.get(`http://127.0.0.1:8000/ieltsgo/api/test/${t}/${n}/${a}/`);console.log("data",p.data),i(p.data)}catch(p){console.error("Error loading test data:",p)}},B=async()=>{try{const p=await q.get("http://127.0.0.1:8000/ieltsgo/api/test_type/names");M(p.data.display_names)}catch(p){console.error("Error fetching test types:",p)}};u(),B()},[t,n,a]),d.useEffect(()=>{if(e!=null&&e.audio_url)return c.current=new Audio(e.audio_url),c.current.preload="auto",c.current.loop=!1,c.current.addEventListener("canplaythrough",()=>{console.log("Audio is ready to play.")}),c.current.addEventListener("error",u=>{console.error("Audio loading error:",u)}),()=>{c.current&&(c.current.pause(),c.current.currentTime=0,c.current=null)}},[e==null?void 0:e.audio_url]),!e)return s.jsx("div",{children:s.jsx(y,{headerNavFields:{skill:t.toUpperCase(),test_type:b[n],show_timer:!1},contentFields:{left_content:s.jsx("div",{children:"NO DATA"})},isDoublePanel:0})});let h,m,g,f,x;t==="writing"?[x,h,m,g,f]=K({question:e.question,diagramUrl:e.diagram_url,testType:n,text:r,setAnswer:l}):n==="single_selection"||n==="double_selection"?[x,h,m,g,f]=V({text:e.text,questions:e.questions,choices_list:e.choices,testType:n,skill:t,setAnswer:l}):n==="fill_table"?[x,h,m,g,f]=Y({text:e.text,table_data:e.table_data,topic:e.topic,skill:t,setAnswer:l}):n==="map"?[x,h,m,g,f]=Z({text:e.text,diagramUrl:e.diagram_url,topic:e.topic,num_questions:e.num_questions,rows:e.rows,skill:t,setAnswer:l}):n==="word_box"||n==="flow_chart"?[x,h,m,g,f]=ee({text:e.text,word_box:e.word_box,questions:e.questions,skill:t,setAnswer:l}):[x,h,m,g,f]=X({text:e.text,questions:e.questions,topics:e.topics,setAnswer:l,testType:n,skill:t});const F=()=>{c.current&&(c.current.play().catch(u=>{console.error("Failed to play audio",u)}),j(!1))},N=()=>{w(!0)},P=()=>{w(!1);let u;e&&(t==="writing"?u={answer:r,question:e.question,external_time:T}:u={answer:r,testData:e,external_time:T}),D(`/evaluation/${t}`,{state:u})},A={skill:t.toUpperCase(),test_type:b[n],show_timer:t!=="listening",is_countdown:g,count_mins:f,setExternalTime:S},E={submit:N,back:()=>D("/test/selection/all"),show_submit:!0,show_arrows:!1,show_back:!0},L={header:x,left_content:t!=="listening"?h:m,right_content:m},k={handle_confirm:P,handle_cancel:()=>w(!1),show_modal:_},R={handle_confirm:F,handle_cancel:()=>D(`/test/intro/${t}/${o}/${n}/${a}`),show_modal:$};return s.jsx("div",{children:s.jsx(y,{headerNavFields:A,footerNavFields:E,contentFields:L,modalFields:k,isDoublePanel:o,audioFields:t==="listening"?R:null})})}export{ie as default};
